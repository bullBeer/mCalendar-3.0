/*
version：v3.0.1
update:2017-12-31
*/
(function(b){var h=document;var f="ontouchstart" in b?"touchstart":"click";var d="ontouchstart" in b?"touchstart":"mousedown";var c="ontouchmove" in b?"touchmove":"mousemove";var i="ontouchend" in b?"touchend":"mouseup";var g=b.requestAnimationFrame||b.webkitRequestAnimationFrame;var e=b.cancelAnimationFrame||b.webkitCancelAnimationFrame;var a="transform" in h.createElement("div").style?"transform":"webkitTransform";b.mCalendar=function(j){var k=this;k.init(j)};b.mCalendar.prototype.byClass=function(k,j){return k.getElementsByClassName(j)};b.mCalendar.prototype.byTag=function(k,j){return k.getElementsByTagName(j)};b.mCalendar.prototype.htmlStrJson={"header":'<div class="mCalendar-countbox">'+'<span class="mCalendar-l-arrow">&lt;</span>'+'<span class="mCalendar-count-number">2000年</span>'+'<span class="mCalendar-r-arrow">&gt;</span>'+"</div>"+'<div class="mCalendar-countbox">'+'<span class="mCalendar-l-arrow">&lt;</span>'+'<span class="mCalendar-count-number">00月</span>'+'<span class="mCalendar-r-arrow">&gt;</span>'+"</div>"+'<div class="mCalendar-btn-item">'+'<span class="mCalendar-btn mCalendar-cancel-btn">取消</span>'+'<span class="mCalendar-btn mCalendar-confirm-btn">完成</span>'+"</div>","dayHeader":"<thead>"+"<tr>"+"<th>日</th>"+"<th>一</th>"+"<th>二</th>"+"<th>三</th>"+"<th>四</th>"+"<th>五</th>"+"<th>六</th>"+"</tr>"+"</thead>"};b.mCalendar.prototype.createElement=function(k,j){var l=document.createElement(k);if(j.className){this.addClass(l,j.className)}j.appendToEl.appendChild(l);return l};b.mCalendar.prototype.hasClass=function(k,j){var j=j||"";if(j.replace(/\s/g,"").length==0){return false}return new RegExp(" "+j+" ").test(" "+k.className+" ")};b.mCalendar.prototype.addClass=function(k,j){if(!b.mCalendar.prototype.hasClass(k,j)){k.className+=" "+j}};b.mCalendar.prototype.removeClass=function(k,j){if(b.mCalendar.prototype.hasClass(k,j)){var l=" "+k.className.replace(/[\t\r\n]/g,"")+" ";while(l.indexOf(" "+j+" ")>=0){l=l.replace(" "+j+" "," ")}k.className=l.replace(/^\s+|\s+$/g,"")}};b.mCalendar.prototype.close=function(){var j=this;j.addClass(j.calendar,"mCalendar-hide")};b.mCalendar.prototype.open=function(){var j=this;j.removeClass(j.calendar,"mCalendar-hide");j.update()};b.mCalendar.prototype.dates=[];b.mCalendar.prototype.months=[];b.mCalendar.prototype.Date=new Date();b.mCalendar.prototype.tablelength=3;b.mCalendar.prototype.rows=6;b.mCalendar.prototype.cols=7;b.mCalendar.prototype.tdslengh=42;b.mCalendar.prototype.layout=function(){var s=this.createElement("div",{"appendToEl":document.body,"className":"mCalendar"});var z=this.createElement("div",{"appendToEl":s,"className":"mCalendar-mask"});var k=this.createElement("div",{"appendToEl":s,"className":"mCalendar-container"});var t=this.createElement("div",{"appendToEl":k,"className":"mCalendar-header"});var v=this.createElement("div",{"appendToEl":k,"className":"mCalendar-body"});var o=this.createElement("div",{"appendToEl":v,"className":"mCalendar-week-header"});var m=this.createElement("table",{"appendToEl":o});var u=this.createElement("div",{"appendToEl":v,"className":"mCalendar-date-group"});t.innerHTML=this.htmlStrJson.header;m.innerHTML=this.htmlStrJson.dayHeader;this.calendar=s;this.dategroup=u;this.addClass(this.calendar,"mCalendar-hide");var l=this.width=this.calendar.offsetWidth;for(var q=0;q<this.tablelength;q++){var y=this.createElement("table",{"appendToEl":u});var p=this.createElement("tbody",{"appendToEl":y});for(var j=0;j<this.rows;j++){var x=this.createElement("tr",{"appendToEl":p});for(var w=0;w<this.cols;w++){var n=this.createElement("td",{"appendToEl":x})}}this.translateX(y,-100+100*q)}};b.mCalendar.prototype.switchDate=function(k,l,m){var m=m+1||250;var n=this;if(Date.now()-n.handlerStart<m){return}n.endX+=n.width*k;n.currentDate[l]+=k*-1;if(n.currentDate.month<0){n.currentDate.year-=1;n.currentDate.month=11}else{if(n.currentDate.month>11){n.currentDate.year+=1;n.currentDate.month=0}}n.currentIndex+=k*-1;if(n.currentIndex>n.tablelength-1){n.currentIndex=0}else{if(n.currentIndex<0){n.currentIndex=n.tablelength-1}}n.tables[n.preIndex].removeAttribute("aria-show");n.tables[n.currentIndex].setAttribute("aria-show","true");if(k===-1){var j=n.currentIndex+1>n.tablelength-1?0:n.currentIndex+1}else{if(k===1){var j=n.currentIndex-1<0?n.tablelength-1:n.currentIndex-1}}n.translateX(n.tables[n.preIndex],(-n.endX+n.width*k)/n.width*100);n.translateX(n.tables[j],(-n.endX+n.width*k*-1)/n.width*100);n.translateX(n.tables[n.currentIndex],(-n.endX)/n.width*100);if(l==="year"){n.drawDate(n.tables[n.preIndex],n.currentDate.year-k*-1,n.currentDate.month);n.drawDate(n.tables[j],n.currentDate.year+k*-1,n.currentDate.month)}else{if(l==="month"){n.drawDate(n.tables[n.preIndex],n.currentDate.year,n.currentDate.month-k*-1);n.drawDate(n.tables[j],n.currentDate.year,n.currentDate.month+k*-1)}}n.drawDate(n.tables[n.currentIndex],n.currentDate.year,n.currentDate.month);n.scrollX({"endX":n.endX,"duration":m,"callback":function(){n.startX=n.endX}});n.update();n.preIndex=n.currentIndex;
n.handlerStart=Date.now()};b.mCalendar.prototype.select=function(){var j=this;j.bindselect=function(){var n=arguments[0];var m=n.target.parentElement;if(m&&m.nodeName.toLowerCase()=="td"&&j.hasClass(m,"activeDay")){var k=m.getAttribute("aria-date");if(j.hasClass(m,"active")){j.removeClass(m,"active");delete j.selectedDates[k]}else{if(!j.multiple){for(var l=0;l<this.tdsAllLen;l++){j.removeClass(j.alltds[l],"active")}j.selectedDates={}}j.selectedDates[k]=k;j.addClass(m,"active")}}}};b.mCalendar.prototype.translateX=function(k,j){k.style[a]="translate3d("+j+"%,0,0)"};b.mCalendar.prototype.scrollX=function(r){var o=this;g?e(o.timer):clearTimeout(o.timer);var m=0,p=o.startX,q=r.endX,n=r.duration||250,j=0,k=Date.now();function l(){if(j/n>=1){g?e(o.timer):clearTimeout(o.timer);o.timer=null;if(r.callback){(r.callback)()}return}j=Math.min(n,(Date.now()-k));m=p+(q-p)/n*j;o.startX=m;o.translateX(o.dategroup,m/o.width*100);o.timer=g?g(l):setTimeout(l,0)}l()};b.mCalendar.prototype.swipeX=function(){var m=this;var l=touchmoveX=moveendX=gapX=0;var k=0;function j(){var n=arguments[0].touches?arguments[0].touches[0]:arguments[0];touchmoveX=n.pageX;gapX=touchmoveX-l;if(touchmoveX>moveendX){k=1}else{k=-1}moveendX&&(m.startX+=(touchmoveX-moveendX));m.translateX(m.dategroup,m.startX/m.width*100);moveendX=n.pageX;arguments[0].preventDefault()}m.dategroup.addEventListener(d,function(){var n=arguments[0].touches?arguments[0].touches[0]:arguments[0];l=n.pageX;m.calendar.addEventListener(c,j,false);arguments[0].preventDefault()},false);m.calendar.addEventListener(i,function(){if(Math.abs(gapX)>10){m.switchDate(k,"month")}else{if(Math.abs(gapX)==0){m.bindselect(arguments[0])}if(Math.abs(gapX)>0&&!m.hasClass(arguments[0].target,"mCalendar-l-arrow")&&!m.hasClass(arguments[0].target,"mCalendar-r-arrow")){m.scrollX({"endX":m.endX,"duration":200,"callback":function(){m.startX=m.endX}})}}l=touchmoveX=moveendX=gapX=0;m.delMoveDelay&&clearTimeout(m.delMoveDelay);m.delMoveDelay=setTimeout(function(){m.calendar.removeEventListener(c,j)},1000)})};b.mCalendar.prototype.drawDate=function(l,w,u){var q=this.byTag(l,"tbody")[0];var w=w;var u=u;if(u<0){w-=1;u=11}else{if(u>11){w+=1;u=0}}var m=1;var t=new Date(w,u+1,0).getDate();var k=new Date(w,u,1).getDay();var s=new Date(w,u,0).getDate()-k+1;var n=1;var x="";var p=[];for(var o=0;o<this.tdslengh;o++){if(o<k){p.push("<td class='mendDay' aria-date="+(u-1<0?w-1:w)+"-"+this.months[u-1<0?11:u-1]+"-"+this.dates[s-1]+">"+"<div>"+s+"</div>"+"</td>");s++}else{if(m>t){p.push("<td class='mendDay' aria-date="+(u+1>11?w+1:w)+"-"+this.months[u+1>11?0:u+1]+"-"+this.dates[n-1]+">"+"<div>"+n+"</div>"+"</td>");n++}else{p.push("<td class='activeDay' aria-date="+w+"-"+this.months[u]+"-"+this.dates[m-1]+">"+"<div>"+m+"</div>"+"</td>");m++}}}for(var j=0;j<this.rows;j++){var y="";for(var v=j*this.cols;v<j*this.cols+this.cols;v++){y+=p[v]}x+="<tr>"+y+"</tr>"}q.innerHTML=x};b.mCalendar.prototype.update=function(){var n=this;n.yearNum.innerHTML=n.currentDate.year+"年";n.monthNum.innerHTML=String(n.currentDate.month+1).length==1?"0"+(n.currentDate.month+1)+"月":n.currentDate.month+1+"月";var m=n.byClass(n.calendar,"activeDay");var j=m.length;Array.prototype.forEach.call(m,function(o){n.removeClass(o,"active")});for(var k=0;k<j;k++){for(var l in n.selectedDates){if(m[k].getAttribute("aria-date")==n.selectedDates[l]){n.addClass(m[k],"active")}}}};b.mCalendar.prototype.init=function(l){var p=this;p.handlerStart=Date.now();p.currentIndex=p.preIndex=1;p.startX=0;p.endX=0;p.layout();p.countbox=p.byClass(p.calendar,"mCalendar-countbox");p.tables=p.byTag(p.dategroup,"table");p.yeararrow_l=p.byClass(p.countbox[0],"mCalendar-l-arrow")[0];p.yeararrow_r=p.byClass(p.countbox[0],"mCalendar-r-arrow")[0];p.datearrow_l=p.byClass(p.countbox[1],"mCalendar-l-arrow")[0];p.datearrow_r=p.byClass(p.countbox[1],"mCalendar-r-arrow")[0];p.yearNum=p.byClass(p.calendar,"mCalendar-count-number")[0];p.monthNum=p.byClass(p.calendar,"mCalendar-count-number")[1];p.cancelBtn=p.byClass(p.calendar,"mCalendar-cancel-btn")[0];p.confirmBtn=p.byClass(p.calendar,"mCalendar-confirm-btn")[0];p.selectedDates={};p.outputDate=[];if(l){if(l.initDate){var j=l.initDate.split(",")[0];var n=j.substr(0,4),o=parseInt(j.substr(5,2))-1,k=j.substr(8,2);o=o<10?"0"+o:o;p.Date=new Date(n,o,k);p.currentDate={"day":p.Date.getDay(),"date":p.Date.getDate(),"month":p.Date.getMonth(),"year":p.Date.getFullYear()}}else{p.Date=new Date();p.currentDate={"day":p.Date.getDay(),"date":p.Date.getDate(),"month":p.Date.getMonth(),"year":p.Date.getFullYear()}}if(l.toBind){l.toBind.addEventListener(d,function(){try{p.selectedDates={};var r=p.outputDate.length?p.outputDate.split(","):l.initDate.split(",");r.forEach(function(t,s){p.selectedDates[t]=t});if(!p.multiple){p.selectedDates={};p.selectedDates[r[0]]=r[0]}}catch(q){p.selectedDates={}}p.open();arguments[0].preventDefault()})}if(l.multiple){p.multiple=true}if(l.callback&&typeof(l.callback)=="function"){p.hasCallback=true;p.callback=l.callback}if(l.inited){l.inited()
}}else{return}for(var m=1;m<=31;m++){if(m<10){m="0"+m}m=String(m);b.mCalendar.prototype.dates.push(m)}for(var m=1;m<=12;m++){if(m<10){m="0"+m}m=String(m);b.mCalendar.prototype.months.push(m)}p.translateX(p.dategroup,p.startX);p.swipeX();p.dategroup.style.height=p.byTag(p.dategroup,"tbody")[0].offsetHeight+"px";p.alltds=p.byTag(p.calendar,"td");p.tdsAllLen=p.alltds.length;for(var m=0;m<p.tablelength;m++){p.drawDate(p.tables[m],p.currentDate.year,p.currentDate.month-1+m)}p.tables[1].setAttribute("aria-show","true");p.update();p.datearrow_l.addEventListener(f,function(){p.switchDate(1,"month",0)},false);p.datearrow_r.addEventListener(f,function(){p.switchDate(-1,"month",0)},false);p.yeararrow_l.addEventListener(f,function(){p.switchDate(1,"year",0)},false);p.yeararrow_r.addEventListener(f,function(){p.switchDate(-1,"year",0)},false);p.select();p.cancelBtn.addEventListener("click",function(){p.close()},false);p.confirmBtn.addEventListener("click",function(){p.close();p.outputDate=[];delete l.initDate;for(var q in p.selectedDates){p.outputDate.push(p.selectedDates[q])}p.outputDate=p.outputDate.sort().join();if(p.hasCallback){(p.callback)()}},false)}})(window);
